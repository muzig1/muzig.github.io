{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://example.com","root":"/"},"pages":[{"title":"About Me","date":"2020-12-30T02:47:04.533Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"æœŸå¾…æœ€å¥½çš„ä½ .","text":"æœŸå¾…æœ€å¥½çš„ä½ . è‡ªæˆ‘ä»‹ç»"},{"title":"categories","date":"2020-12-29T09:41:25.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-12-29T09:44:24.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Golang åˆçº§é¢è¯•","slug":"golang-primary-interview","date":"2020-12-27T20:18:15.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"2020/12/27/golang-primary-interview/","link":"","permalink":"http://example.com/2020/12/27/golang-primary-interview/","excerpt":"æœ€è¿‘éœ€è¦ç­”è¾©, æ”¶é›†äº†éƒ¨åˆ†æ¥è‡ªå„æ–¹çš„å®æˆ˜é¢è¯•å†…å®¹, ä¾¿äºå·©å›º. å¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¯·äºˆæŒ‡æ­£ ğŸ™.","text":"æœ€è¿‘éœ€è¦ç­”è¾©, æ”¶é›†äº†éƒ¨åˆ†æ¥è‡ªå„æ–¹çš„å®æˆ˜é¢è¯•å†…å®¹, ä¾¿äºå·©å›º. å¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¯·äºˆæŒ‡æ­£ ğŸ™. TODO å‚è€ƒé“¾æ¥ åŸºç¡€ç¯‡ æ¦‚å¿µç¯‡ æ¡†æ¶ç¯‡ å¼€æºæ¡†æ¶ æ•°æ®åº“ç¯‡ çº¿ä¸Šç»éªŒ ç¼–ç¨‹é¢˜ å®ç°å­—ç¬¦ä¸²åŒ¹é…æ£€æŸ¥ å®ç°ä¸€ç§æˆ–å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³• TODO å°½å¯èƒ½å®Œå–„é¢˜ç›®ç­”æ¡ˆ å‚è€ƒé“¾æ¥ ShowMeBug-åˆçº§ Golang é¢è¯•è§†é¢‘ åŸºç¡€ç¯‡ new å’Œ make çš„åŒºåˆ«? éƒ½æ˜¯ç”¨äºåˆ†é…å†…å­˜, åŒºåˆ«åœ¨äº: å‰è€…ä¸»è¦ç”¨äºåˆ›å»ºè¿”å›ç±»å‹çš„æŒ‡é’ˆå¼•ç”¨; åè€…åªèƒ½ç”¨äº slice / map / channel çš„åˆå§‹åŒ–. è¡¥å……: å…¶å® new ä¸å¸¸ç”¨, ç›¸æ¯”è¾ƒä¸‹å­—é¢é‡åˆå§‹åŒ–çš„æ–¹å¼æ›´ä¸ºå¸¸ç”¨, åŒæ—¶è·å–æŒ‡é’ˆå¼•ç”¨ä¹‹å, å¯¹äºå¯¹è±¡çš„èµ‹å€¼, è¿˜ä¼šå¯¼è‡´é—´æ¥èµ‹å€¼çš„é€ƒé€¸é—®é¢˜ å‡½æ•°è°ƒç”¨ä¼ å¼•ç”¨ç±»å‹è¿˜æ˜¯å€¼ç±»å‹? (æ¶‰åŠé€ƒé€¸é—®é¢˜) ä¸€èˆ¬é‡‡ç”¨å¼•ç”¨ç±»å‹, å°‘æ•°é‡‡ç”¨å€¼ç±»å‹, è¿™é‡Œä¸»è¦å‚è€ƒçš„æ˜¯: å‡½æ•°å†…éœ€è¦æˆ–è€…ä¸éœ€è¦ä¿®æ”¹å¼•ç”¨ç±»å‹çš„å€¼; å…¶ä»–æƒ…å†µè€ƒè™‘é€ƒé€¸çš„é—®é¢˜, è‹¥å‡½æ•°æ˜¯å˜é‡, åˆ™å‡½æ•°å‚æ•°æ˜¯å¼•ç”¨çš„è¯, ä¼šå¯¼è‡´å‡½æ•°å˜é‡é€ƒé€¸. åå°„çš„åŸç†? (å¦‚ä½•è§£æ struct çš„ tag) recover èƒ½æ•è·å­ goroutine çš„ panic å—? é”ç›¸å…³çš„ä½¿ç”¨æƒ…å†µ? è‡ªå·±ä½¿ç”¨ channel çš„ä½¿ç”¨åœºæ™¯ä»¥åŠå‘? æ¦‚å¿µç¯‡ å†…å­˜ç®¡ç† çº¿ç¨‹åç¨‹çš„å ç”¨å†…å­˜å¤§å°? è¿›ç¨‹æ¨¡å‹ è¿›ç¨‹çŠ¶æ€è½¬æ¢ çº¿ç¨‹æ¨¡å‹ çº¿ç¨‹å¦‚æœå‘ç”Ÿ OOM å¦‚ä½•æ’æŸ¥å¤„ç†? åŒç† goroutine å‘ç”Ÿ OOM ? è°ƒåº¦é€»è¾‘ ä»€ä¹ˆæ—¶å€™ goroutine é˜»å¡? è°ƒåº¦å™¨å¦‚ä½•å¤„ç†? goroutine ä¸€ç›´å ç”¨èµ„æºå¦‚ä½•å¤„ç†? æ¡†æ¶ç¯‡ é¡¹ç›®ä¸­å¦‚ä½•é”™è¯¯å¤„ç†? ä¼šè‡ªå®šä¹‰ error é”™è¯¯å¤„ç†å—? gRPC ä½¿ç”¨æƒ…å†µ? æœåŠ¡å‘ç°/è´Ÿå€ºå‡è¡¡çš„å®ç°? proto æ–‡ä»¶å¦‚ä½•ç®¡ç†? (monorepo å°è¯•) å¦‚æœä¸­å¿ƒèŠ‚ç‚¹æŒ‚æ‰å¦‚ä½•å¤„ç†? (Raftç®—æ³•ä¿è¯å¯é æ€§) å¼€æºæ¡†æ¶Web: gin beego Gin ä¸­çš„è‡ªå®šä¹‰å‚æ•°æ ¡éªŒè§„åˆ™? Gin ä¸­é—´ä»¶çš„ä½¿ç”¨æƒ…å†µ Game: leaf origin leaf çš„æ¶ˆæ¯è·¯ç”±æ–¹å¼? æ•°æ®åº“ç¯‡ mongodb mysql redis redis mongodb mysql çš„é”æœºåˆ¶? redis çš„åŸºæœ¬å†…å®¹, ä½¿ç”¨æƒ…å†µ? redis æŒä¹…æ€§å¦‚ä½•å¤„ç†? mysql ORMä½¿ç”¨æƒ…å†µ? (XORM / GORM) mysql åˆ†åº“åˆ†è¡¨æƒ…å†µ? (åˆ†ç‰‡å­˜å‚¨, HBaseå­˜å‚¨) ä¸»ä»æ¨¡å¼/é›†ç¾¤æ¨¡å¼/å“¨å…µæ¨¡å¼åŒºåˆ«? çº¿ä¸Šç»éªŒ çº¿ä¸Š bug å¦‚ä½•æ’æŸ¥? å¦‚ä½•åˆ†æçº¿ä¸Šæ€§èƒ½ç“¶é¢ˆ? ç¼–ç¨‹é¢˜å®ç°å­—ç¬¦ä¸²åŒ¹é…æ£€æŸ¥æ­£ç¡®è¾“å‡ºä»¥ä¸‹ç»“æœ: å³éœ€è¦åŒæ—¶æˆå¯¹çš„ç¬¦å·, å³åˆ¤æ–­æˆåŠŸ 123&quot;[()]&quot; =&gt; true&quot;[(]&quot; =&gt; false&quot;&#123;]]&quot; =&gt; false å®ç°ä¸€ç§æˆ–å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•","categories":[],"tags":[{"name":"golang","slug":"golang","permalink":"http://example.com/tags/golang/"},{"name":"interview","slug":"interview","permalink":"http://example.com/tags/interview/"}]},{"title":"Golang Escape Analysis","slug":"golang-escape-analysis","date":"2020-12-27T14:42:27.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"2020/12/27/golang-escape-analysis/","link":"","permalink":"http://example.com/2020/12/27/golang-escape-analysis/","excerpt":"äº†è§£ Golang è¯­è¨€çš„é€ƒé€¸æœºåˆ¶, æœ‰åŠ©äºåœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ç»•å¼€é€ƒé€¸åˆ†æçš„ç¼ºé™·, ä»è€Œç¼–å†™æ›´åŠ é«˜æ•ˆçš„ä»£ç .","text":"äº†è§£ Golang è¯­è¨€çš„é€ƒé€¸æœºåˆ¶, æœ‰åŠ©äºåœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ç»•å¼€é€ƒé€¸åˆ†æçš„ç¼ºé™·, ä»è€Œç¼–å†™æ›´åŠ é«˜æ•ˆçš„ä»£ç . å…³äºå †æ ˆ é€ƒé€¸åˆ†æ å‡½æ•°å˜é‡ é—´æ¥èµ‹å€¼ interface channel å¯å˜å‚æ•° æ€»ç»“ å‚è€ƒé“¾æ¥ Go è¯­è¨€è¾ƒä¹‹ C è¯­è¨€ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿å°±æ˜¯è‡ªå¸¦ GC åŠŸèƒ½ï¼Œå¯ GC å¹¶ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ã€‚å†™ C è¯­è¨€çš„æ—¶å€™ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°å†…å£°æ˜çš„å˜é‡ï¼Œåœ¨å‡½æ•°é€€å‡ºåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ï¼Œå› ä¸ºè¿™äº›å˜é‡åˆ†é…åœ¨æ ˆä¸Šã€‚å¦‚æœä½ æƒ³è¦å˜é‡çš„æ•°æ®èƒ½åœ¨å‡½æ•°é€€å‡ºåè¿˜èƒ½è®¿é—®ï¼Œå°±éœ€è¦è°ƒç”¨ malloc æ–¹æ³•åœ¨å †ä¸Šç”³è¯·å†…å­˜ï¼Œå¦‚æœç¨‹åºä¸å†éœ€è¦è¿™å—å†…å­˜äº†ï¼Œå†è°ƒç”¨ free æ–¹æ³•é‡Šæ”¾æ‰ã€‚Go è¯­è¨€ä¸éœ€è¦ä½ ä¸»åŠ¨è°ƒç”¨ malloc æ¥åˆ†é…å †ç©ºé—´ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆ†æï¼Œæ‰¾å‡ºéœ€è¦ malloc çš„å˜é‡ï¼Œä½¿ç”¨å †å†…å­˜ã€‚ç¼–è¯‘å™¨çš„è¿™ä¸ªåˆ†æè¿‡ç¨‹å°±å«åšé€ƒé€¸åˆ†æã€‚ å…³äºå †æ ˆåŒºåˆ«å¦‚ä¸‹: ç”³è¯·æ–¹å¼çš„ä¸åŒã€‚æ ˆç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œè€Œå †æ˜¯äººä¸ºç”³è¯·å¼€è¾Ÿ; ç”³è¯·å¤§å°çš„ä¸åŒã€‚æ ˆè·å¾—çš„ç©ºé—´è¾ƒå°ï¼Œè€Œå †è·å¾—çš„ç©ºé—´è¾ƒå¤§; ç”³è¯·æ•ˆç‡çš„ä¸åŒã€‚æ ˆç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œè€Œå †ä¸€èˆ¬é€Ÿåº¦æ¯”è¾ƒæ…¢; å­˜å‚¨å†…å®¹çš„ä¸åŒã€‚æ ˆåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œå‡½æ•°è°ƒç”¨è¯­å¥çš„ä¸‹ä¸€æ¡å¯æ‰§è¡Œè¯­å¥çš„åœ°å€ç¬¬ä¸€ä¸ªè¿›æ ˆï¼Œç„¶åå‡½æ•°çš„å„ä¸ªå‚æ•°è¿›æ ˆï¼Œå…¶ä¸­é™æ€å˜é‡æ˜¯ä¸å…¥æ ˆçš„ã€‚è€Œå †ä¸€èˆ¬æ˜¯åœ¨å¤´éƒ¨ç”¨ä¸€ä¸ªå­—èŠ‚å­˜æ”¾å †çš„å¤§å°ï¼Œå †ä¸­çš„å…·ä½“å†…å®¹æ˜¯äººä¸ºå®‰æ’; åº•å±‚ä¸åŒã€‚æ ˆæ˜¯è¿ç»­çš„ç©ºé—´ï¼Œè€Œå †æ˜¯ä¸è¿ç»­çš„ç©ºé—´ã€‚ è¯¦ç»†ç»†èŠ‚é“¾æ¥: Language Mechanics On Stacks And Pointers Language Mechanics On Escape Analysis 12345678910func stack() int &#123; // å˜é‡ i ä¼šåœ¨æ ˆä¸Šåˆ†é… i := 10 return i&#125;func heap() *int &#123; // å˜é‡ j ä¼šåœ¨å †ä¸Šåˆ†é… j := 10 return &amp;j&#125; 123# åˆ†ææ±‡ç¼–æŒ‡ä»¤å¦‚ä¸‹:go build --gcflags &#x27;-l&#x27; test.gogo tool objdump ./test !!! ä¸è¦ä»¥ä¸ºä½¿ç”¨äº†å †å†…å­˜å°±ä¸€å®šä¼šå¯¼è‡´æ€§èƒ½ä½ä¸‹ï¼Œä½¿ç”¨æ ˆå†…å­˜ä¼šå¸¦æ¥æ€§èƒ½ä¼˜åŠ¿ã€‚å› ä¸ºå®é™…é¡¹ç›®ä¸­ï¼Œç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆä¸€èˆ¬éƒ½ä¸ä¼šå‡ºç°åœ¨å†…å­˜åˆ†é…ä¸Šã€‚åƒä¸‡ä¸è¦ç›²ç›®ä¼˜åŒ–ï¼Œæ‰¾åˆ°ç³»ç»Ÿç“¶é¢ˆï¼Œç”¨æ•°æ®é©±åŠ¨ä¼˜åŒ–ã€‚ é€ƒé€¸åˆ†æéœ€è¦ä½¿ç”¨å †ç©ºé—´åˆ™é€ƒé€¸ï¼Œè¿™æ²¡ä»€ä¹ˆå¯äº‰è®®çš„ã€‚ä½†ç¼–è¯‘å™¨æœ‰æ—¶ä¼šå°†ä¸éœ€è¦ä½¿ç”¨å †ç©ºé—´çš„å˜é‡ï¼Œä¹Ÿé€ƒé€¸æ‰ã€‚è¿™é‡Œæ˜¯å®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜çš„å¤§å‘ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šç›¸å…³æ–‡ç« ï¼Œåˆ—ä¸¾äº†ä¸€äº›å¯¼è‡´é€ƒé€¸æƒ…å†µï¼Œå…¶å®æ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼š å¤šçº§é—´æ¥èµ‹å€¼å®¹æ˜“å¯¼è‡´é€ƒé€¸ã€‚ Go è¯­è¨€ä¸­çš„å¼•ç”¨ç±»æ•°æ®ç±»å‹æœ‰ func, interface, slice, map, chan, *Type(æŒ‡é’ˆ)ã€‚ è®°ä½å…¬å¼ Data.Field = Valueï¼Œå¦‚æœ Data, Field éƒ½æ˜¯å¼•ç”¨ç±»çš„æ•°æ®ç±»å‹ï¼Œåˆ™ä¼šå¯¼è‡´ Value é€ƒé€¸ã€‚è¿™é‡Œçš„ç­‰å· = ä¸å•å•åªèµ‹å€¼ï¼Œä¹Ÿè¡¨ç¤ºå‚æ•°ä¼ é€’ã€‚ å‡½æ•°å˜é‡ è‹¥å‡½æ•°æ˜¯å˜é‡, ä¸”å‚æ•°ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹, åˆ™ä¼šå‘ç”Ÿé€ƒé€¸ é—´æ¥èµ‹å€¼ è‰¯å¥½çš„å†™æ³•æ˜¯, åœ¨è¿”å›çš„æ—¶å€™å†å¼•ç”¨åœ°å€ 1234567891011121314151617181920212223type Data struct &#123; data map[int]int slice []int ch chan int inf interface&#123;&#125; p *int&#125;func main() &#123; d1 := Data&#123;&#125; d1.data = make(map[int]int) // GOOD: does not escape d1.slice = make([]int, 4) // GOOD: does not escape d1.ch = make(chan int, 4) // GOOD: does not escape d1.inf = 3 // GOOD: does not escape d1.p = new(int) // GOOD: does not escape d2 := new(Data) // d2 æ˜¯æŒ‡é’ˆå˜é‡ï¼Œ ä¸‹é¢ä¸ºè¯¥æŒ‡é’ˆå˜é‡ä¸­çš„æŒ‡é’ˆæˆå‘˜èµ‹å€¼ d2.data = make(map[int]int) // BAD: escape to heap d2.slice = make([]int, 4) // BAD: escape to heap d2.ch = make(chan int, 4) // BAD: escape to heap d2.inf = 3 // BAD: escape to heap d2.p = new(int) // BAD: escape to heap&#125; interfaceåªè¦ä½¿ç”¨äº† Interface ç±»å‹(ä¸æ˜¯ interafce{})ï¼Œé‚£ä¹ˆèµ‹å€¼ç»™å®ƒçš„å˜é‡ä¸€å®šä¼šé€ƒé€¸ã€‚å› ä¸º interfaceVariable.Method() å…ˆæ˜¯é—´æ¥çš„å®šä½åˆ°å®ƒçš„å®é™…å€¼ï¼Œå†è°ƒç”¨å®é™…å€¼çš„åŒåæ–¹æ³•ï¼Œæ‰§è¡Œæ—¶å®é™…å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ã€‚ç›¸å½“äºinterfaceVariable.Method.this = realValue 123456789101112131415type Iface interface &#123; Dummy()&#125;type Integer intfunc (i Integer) Dummy() &#123;&#125;func main() &#123; var ( iface Iface i Integer ) iface = i iface.Dummy() // make i escape to heap // å½¢æˆ iface.Dummy.i = i&#125; channel å‘é€åˆ° channel çš„æ•°æ®ç±»å‹éƒ½å°†é€ƒé€¸ 12345678910111213func test() &#123; var ( chInteger = make(chan *int) chMap = make(chan map[int]int) chSlice = make(chan []int) chInterface = make(chan interface&#123;&#125;) a, b, c, d = 0, map[int]int&#123;&#125;, []int&#123;&#125;, 32 ) chInteger &lt;- &amp;a // é€ƒé€¸ chMap &lt;- b // é€ƒé€¸ chSlice &lt;- c // é€ƒé€¸ chInterface &lt;- d // é€ƒé€¸&#125; å¯å˜å‚æ•°å¯å˜å‚æ•°å¦‚ func(arg â€¦string) å®é™…ä¸ func(arg []string) æ˜¯ä¸€æ ·çš„ï¼Œä¼šå¢åŠ ä¸€å±‚è®¿é—®è·¯å¾„ã€‚è¿™ä¹Ÿæ˜¯ fmt.Sprintf æ€»æ˜¯ä¼šä½¿å‚æ•°é€ƒé€¸çš„åŸå› ã€‚ ä¾‹å­éå¸¸å¤šï¼Œè¿™é‡Œä¸èƒ½ä¸€ä¸€åˆ—ä¸¾ï¼Œæˆ‘ä»¬åªéœ€è¦è®°ä½åˆ†ææ–¹æ³•å°±å¥½ å³ï¼Œ2 çº§æˆ–æ›´å¤šçº§çš„è®¿é—®èµ‹å€¼ä¼šå®¹æ˜“å¯¼è‡´æ•°æ®é€ƒé€¸ã€‚è¿™é‡ŒåŠ ä¸Šå®¹æ˜“äºŒå­—æ˜¯å› ä¸ºéšç€è¯­è¨€çš„å‘å±•ï¼Œç›¸ä¿¡è¿™äº›é—®é¢˜ä¼šè¢«æ…¢æ…¢è§£å†³ï¼Œä½†ç°é˜¶æ®µï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºæˆ‘ä»¬åˆ†æé€ƒé€¸ç°è±¡çš„ä¾æ®ã€‚ 123456789101112type User struct &#123; roles []string&#125;func (u *User) SetRoles(roles []string) &#123; u.roles = roles&#125;func SetRoles(u User, roles []string) User &#123; u.roles = roles return u&#125; 12345678910111213141516171819202122232425type User struct &#123; A []string&#125;func (u *User) Set(a []string) &#123; u.A = a&#125;func SetUser(user User, a []string) User &#123; user.A = a return user&#125;func BenchmarkUser(b *testing.B) &#123; // BenchmarkUser-4 39182143 29.0 ns/op //u := new(User) //for i := 0; i &lt; b.N; i++ &#123; // u.Set([]string&#123;&quot;a&quot;&#125;) //&#125; // BenchmarkUser-4 1000000000 0.585 ns/op for i := 0; i &lt; b.N; i++ &#123; _ = SetUser(User&#123;&#125;, []string&#123;&quot;a&quot;&#125;) &#125;&#125; æ€»ç»“ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¼˜åŒ–éƒ½ä¼šä¸ºç¨‹åºå¸¦æ¥ä¸€å®šçš„å¤æ‚åº¦ã€‚å»ºè®®å®é™…é¡¹ç›®ä¸­è¿˜æ˜¯æ€ä¹ˆæ–¹ä¾¿æ€ä¹ˆå†™ï¼ŒåŠŸèƒ½å®Œæˆåé€šè¿‡æ€§èƒ½åˆ†ææ‰¾åˆ°ç“¶é¢ˆæ‰€åœ¨ï¼Œå†å¯¹å±€éƒ¨è¿›è¡Œä¼˜åŒ–ã€‚ å¤šçº§é—´æ¥èµ‹å€¼ä¼šå¯¼è‡´ Go ç¼–è¯‘å™¨å‡ºç°ä¸å¿…è¦çš„é€ƒé€¸ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹æ•°æ®ç»“æ„å°±ä¼šä½¿æ€§èƒ½æœ‰å¤§å¹…æå‡ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šäººä¸æ¨èåœ¨ Go ä¸­ä½¿ç”¨æŒ‡é’ˆçš„åŸå› ï¼Œå› ä¸ºå®ƒä¼šå¢åŠ ä¸€çº§è®¿é—®è·¯å¾„ï¼Œè€Œ map, slice, interface{}ç­‰ç±»å‹æ˜¯ä¸å¯é¿å…è¦ç”¨åˆ°çš„ï¼Œä¸ºäº†å‡å°‘ä¸å¿…è¦çš„é€ƒé€¸ï¼Œåªèƒ½æ‹¿æŒ‡é’ˆå¼€åˆ€äº†ã€‚ å‚è€ƒé“¾æ¥ è¾¾è²æ ¼-Go è¯­è¨€å†…å­˜ç®¡ç†ï¼ˆä¸‰ï¼‰ï¼šé€ƒé€¸åˆ†æ","categories":[],"tags":[{"name":"golang","slug":"golang","permalink":"http://example.com/tags/golang/"},{"name":"escape-analysis","slug":"escape-analysis","permalink":"http://example.com/tags/escape-analysis/"}]},{"title":"Golang GC","slug":"golang-GC","date":"2020-12-26T23:32:41.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"2020/12/26/golang-GC/","link":"","permalink":"http://example.com/2020/12/26/golang-GC/","excerpt":"æ ‡è®°æ¸…é™¤ å¹¶è¡Œæ ‡è®°æ¸…é™¤ ä¸‰è‰²æ ‡è®°æ³• Hybrid Write Barrier","text":"æ ‡è®°æ¸…é™¤ å¹¶è¡Œæ ‡è®°æ¸…é™¤ ä¸‰è‰²æ ‡è®°æ³• Hybrid Write Barrier æ ‡è®°æ¸…é™¤ &amp; å¹¶è¡Œæ ‡è®°æ¸…é™¤ ä¸‰è‰²æ ‡è®°æ³• Hybrid Write Barrier (æ··åˆå†™å±éšœ) ä½•æ—¶è§¦å‘ GC å…¶ä»–ä¼˜åŒ– å±•æœ› ç»“è®º å‚è€ƒé“¾æ¥ æ ‡è®°æ¸…é™¤ &amp; å¹¶è¡Œæ ‡è®°æ¸…é™¤GC å¼€å§‹ä¹‹å, å¯åŠ¨ STW ç„¶åä» root å¼€å§‹, root åŒºå€¼å½“å‰æ‰€æœ‰ goroutine çš„æ ˆå’Œå…¨å±€æ•°æ®åŒºçš„å˜é‡(ä¸»è¦æ˜¯è¿™ 2 ä¸ªåœ°æ–¹), å°†èƒ½è¢«è§¦åŠçš„ object æ ‡è®°, å‰©ä¸‹çš„å°±æ˜¯å¯å›æ”¶çš„; æœ€åå†æ¸…ç†æ”¾å› mcache ä¸­, ä»¥å¤‡åç»­ä½¿ç”¨. å¹¶è¡Œæ ‡è®°æ¸…é™¤, å®é™…ä¸Šæ˜¯æ¸…ç†è¿‡ç¨‹ä¸éœ€è¦ STW, å‡å°‘äº† STW çš„æ—¶é—´. ä¸‰è‰²æ ‡è®°æ³• æ­£å¸¸æƒ…å†µä¸‹ï¼Œå†™æ“ä½œå°±æ˜¯æ­£å¸¸çš„èµ‹å€¼ã€‚ GC å¼€å§‹ï¼Œå¼€å¯å†™å±éšœç­‰å‡†å¤‡å·¥ä½œã€‚å¼€å¯å†™å±éšœç­‰å‡†å¤‡å·¥ä½œéœ€è¦çŸ­æš‚çš„ STWã€‚ Stack scan é˜¶æ®µï¼Œä»å…¨å±€ç©ºé—´å’Œ goroutine æ ˆç©ºé—´ä¸Šæ”¶é›†å˜é‡ã€‚ Mark é˜¶æ®µï¼Œæ‰§è¡Œä¸Šè¿°çš„ä¸‰è‰²æ ‡è®°æ³•ï¼Œç›´åˆ°æ²¡æœ‰ç°è‰²å¯¹è±¡ã€‚ Mark termination é˜¶æ®µï¼Œå¼€å¯ STWï¼Œå›å¤´é‡æ–°æ‰«æ root åŒºåŸŸæ–°å˜é‡ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ ‡è®°ã€‚ Sweep é˜¶æ®µï¼Œå…³é—­ STW å’Œ å†™å±éšœï¼Œå¯¹ç™½è‰²å¯¹è±¡è¿›è¡Œæ¸…é™¤ã€‚ Hybrid Write Barrier (æ··åˆå†™å±éšœ)Go åœ¨ 1.8 ç‰ˆæœ¬å¼•å…¥äº†æ··åˆå†™å±éšœï¼Œå…¶ä¼šåœ¨èµ‹å€¼å‰ï¼Œå¯¹æ—§æ•°æ®ç½®ç°ï¼Œå†è§†æƒ…å†µå¯¹æ–°å€¼è¿›è¡Œç½®ç°ã€‚ ä½•æ—¶è§¦å‘ GC å®¹é‡è§¦å‘ - è¾¾åˆ°è®¾ç½®çš„é˜ˆå€¼è§¦å‘ GC, é»˜è®¤ä¸º100(å³å†…å­˜å¢é•¿100%å³è§¦å‘ä¸€æ¬¡), å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ GOGC æˆ–è€… debug.SetGCPercent() æ—¶é—´è§¦å‘ - æ¯éš” 2 åˆ†é’Ÿ, è§¦å‘ä¸€æ¬¡ GC æ‰‹åŠ¨è§¦å‘ - runtime.GC() å…¶ä»–ä¼˜åŒ– åªä¼šå ç”¨ 25% çš„ cpu ç®—åŠ›å¤„ç† GC é€»è¾‘, ä¿è¯å‡å°‘å¯¹ç”¨æˆ·çš„å½±å“. è‹¥ä¸‹ä¸€è½® GC è§¦å‘, ä¼šç­‰å¾…ä¸Šä¸€è½®æ‰§è¡Œå®Œæ¯• å¯¹äº tiny å¯¹è±¡, ç›´æ¥æ ‡è®°é»‘è‰², æ²¡æœ‰ç°è‰²é˜¶æ®µ, å› ä¸ºä¸å­˜åœ¨å¼•ç”¨å¯¹è±¡ é‡‡ç”¨å¯¹è±¡æ± çš„æ–¹å¼, å‡å°‘ GC çš„å‹åŠ›, ä½†å®é™…ä¸Šä¹Ÿä¼šå­˜åœ¨æ ‡è®°çš„å‹åŠ›; å¦‚æœå¯ä»¥æ”¾åœ¨æ°¸ä¹…æ ‡è®°, å°±å¯ä»¥å‡å°‘æ ‡è®°å‹åŠ› ç›´æ¥ç”³è¯·å¤§å†…å­˜(å¤§äº32k), å¯¹ GC æ¥è¯´æ˜¯ä¸€ä¸ª largespan; éœ€è¦è‡ªè¡Œä»£ç ç®¡ç† å±•æœ› å¼•å…¥åˆ†ä»£æœºåˆ¶, åƒ JVM é‚£æ ·å†…å­˜åˆ†ä¸º ä¸€çº§/äºŒçº§/æ°¸ä¹…, ä¸åŒçº§åˆ«, é‡‡ç”¨ä¸åŒçš„è®¡ç®—èµ„æº ç»“è®º å‡å°‘å±‚çº§æ•° - åµŒå¥—å±‚çº§è¶Šå¤š, å¯¹äº GC çš„å‹åŠ›è¶Šå¤§; å¦‚: chan map[string][]*string å‚è€ƒé“¾æ¥ å´æˆ´å‡-Golang GCæ ¸å¿ƒè¦ç‚¹å’Œåº¦é‡æ–¹æ³• å´æˆ´å‡-å¸¸è§GCç®—æ³•åŠGolang GC è¾¾è²æ ¼-Go è¯­è¨€å†…å­˜ç®¡ç†ï¼ˆå››ï¼‰","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://example.com/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"golang","slug":"golang","permalink":"http://example.com/tags/golang/"},{"name":"gc","slug":"gc","permalink":"http://example.com/tags/gc/"}]},{"title":"Golang Scheduling","slug":"golang-scheduling","date":"2020-12-26T15:40:47.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"2020/12/26/golang-scheduling/","link":"","permalink":"http://example.com/2020/12/26/golang-scheduling/","excerpt":"ç†Ÿæ‚‰ Golang çš„è°ƒåº¦åŸç†, èƒ½å¤Ÿå¸®åŠ©ç¼–å†™æ›´åŠ é«˜æ•ˆçš„å¹¶å‘é€»è¾‘; åŒæ—¶è¿˜èƒ½é¿å…è°ƒåº¦ç›¸å…³çš„å‘. GPM æ¨¡å‹ å‚è€ƒé“¾æ¥","text":"ç†Ÿæ‚‰ Golang çš„è°ƒåº¦åŸç†, èƒ½å¤Ÿå¸®åŠ©ç¼–å†™æ›´åŠ é«˜æ•ˆçš„å¹¶å‘é€»è¾‘; åŒæ—¶è¿˜èƒ½é¿å…è°ƒåº¦ç›¸å…³çš„å‘. GPM æ¨¡å‹ å‚è€ƒé“¾æ¥ GPM æ¨¡å‹ G(Goroutine) P(Process) M(Machine) å‚è€ƒé“¾æ¥ å´æˆ´å‡-Go è°ƒåº¦æ¨¡å‹ å´æˆ´å‡-å†è°ˆè°ƒåº¦ è¾¾è²æ ¼-Go è¯­è¨€è°ƒåº¦ï¼ˆä¸€ï¼‰: ç³»ç»Ÿè°ƒåº¦ è¾¾è²æ ¼-Go è¯­è¨€è°ƒåº¦ï¼ˆäºŒï¼‰: goroutine è°ƒåº¦å™¨ è¾¾è²æ ¼-Go è¯­è¨€è°ƒåº¦ï¼ˆä¸‰ï¼‰: å¹¶å‘","categories":[],"tags":[{"name":"golang","slug":"golang","permalink":"http://example.com/tags/golang/"},{"name":"scheduling","slug":"scheduling","permalink":"http://example.com/tags/scheduling/"}]},{"title":"Goland ç ´è§£æ•™ç¨‹","slug":"goland-cracking","date":"2020-12-05T12:58:28.000Z","updated":"2020-12-30T02:47:04.533Z","comments":true,"path":"2020/12/05/goland-cracking/","link":"","permalink":"http://example.com/2020/12/05/goland-cracking/","excerpt":"ç ´è§£æ–¹å¼: å¾ªç¯é‡ç½®è¯•ç”¨æ—¶é—´.","text":"ç ´è§£æ–¹å¼: å¾ªç¯é‡ç½®è¯•ç”¨æ—¶é—´. æ•™ç¨‹ å‹æƒ…é“¾æ¥ æ•™ç¨‹æ­¥éª¤: æ‰“å¼€ goland, é€‰æ‹©è¯•ç”¨, è¿›å…¥IDEç•Œé¢ Menu - Goland - Perference - Plugins ç‚¹å‡»åƒé½¿è½®çš„å›¾æ ‡(å¦‚ä¸‹å›¾) Manager Plugin Repos æ·»åŠ æ­¤é“¾æ¥: https://plugins.zhile.io, ç­‰å¾…åˆ·æ–°å®Œæˆ æœç´¢æ’ä»¶ IDE Eval reset, æ’ä»¶æè¿°æœ‰è¯´æ˜å’Œä½¿ç”¨æ–¹æ³• ä¸‹è½½å®‰è£…é‡å¯ IDE å‹æƒ…é“¾æ¥ ç ´è§£å¤§ä½¬åšå®¢","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://example.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"crack","slug":"crack","permalink":"http://example.com/tags/crack/"},{"name":"goland","slug":"goland","permalink":"http://example.com/tags/goland/"}]}],"categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://example.com/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://example.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"golang","slug":"golang","permalink":"http://example.com/tags/golang/"},{"name":"interview","slug":"interview","permalink":"http://example.com/tags/interview/"},{"name":"escape-analysis","slug":"escape-analysis","permalink":"http://example.com/tags/escape-analysis/"},{"name":"gc","slug":"gc","permalink":"http://example.com/tags/gc/"},{"name":"scheduling","slug":"scheduling","permalink":"http://example.com/tags/scheduling/"},{"name":"crack","slug":"crack","permalink":"http://example.com/tags/crack/"},{"name":"goland","slug":"goland","permalink":"http://example.com/tags/goland/"}]}